var keyName="instapinboard:Account",queueName="instapinboard:QueuedItem";function constructTokenAuthString(a){return"&auth_token="+a.Token}function constructUrl(a,c,d){var a="https://"+a,b=!0,e;if(c)for(e in a+="?",c)c.hasOwnProperty(e)&&(b||(a+="&"),a+=e+"="+encodeURIComponent(c[e]),b=!1);return a+constructTokenAuthString(d)}
function post(a,c,d){var b=new XMLHttpRequest,a=constructUrl("api.pinboard.in/v1/posts/add",{url:a.url,description:a.description,tags:c.tags,toread:c.toread,shared:c.shared},c);b.open("GET",a);b.onreadystatechange=function(){if(4===b.readyState){var a=/result\s+code=\"done\"/;""!==b.responseText&&!a.test(b.responseText)?alert("Something went wrong! This is super helpful. Blame delicious' API. "+b.responseText):d&&d()}};b.send()}
function postToPinboard(a,c){var d={url:c.url,description:c.title},b=JSON.parse(localStorage.getItem(keyName));b&&b.Token?post(d,b):(localStorage.setItem(queueName,JSON.stringify(d)),chrome.tabs.create({url:"settings.html"}))}function toggleStatus(){var a=document.getElementById("status");a.style.visibility="visible"===a.style.visibility?"hidden":"visible"}
function testAccount(a,c,d){var b=new XMLHttpRequest,a=constructUrl("api.pinboard.in/v1/posts/recent",{count:"1"},c);b.open("GET",a);b.onreadystatechange=function(){4===b.readyState&&(toggleStatus(),200===b.status?d():alert("There was an issue loading your account. Make sure your account details are correct."))};b.send()}function cleanTags(a){return a?a.replace(/[^\w\-_\+\s]/,""):""}function closeTab(){chrome.tabs.getCurrent(function(a){a&&chrome.tabs.remove(a.id)})}
function setAcctDetails(){var a=document.getElementById("token"),c=document.getElementById("tags"),d=document.getElementById("private"),b=document.getElementById("toread"),e,f;""!==a.value?(toggleStatus(),e={Token:a.value,shared:d.checked?"no":"yes",toread:b.checked?"yes":"no",tags:cleanTags(c.value)},localStorage.getItem(queueName)?(f=localStorage.getItem(queueName),testAccount(f,e,function(){localStorage.setItem(keyName,JSON.stringify(e));post(JSON.parse(f),e,closeTab)})):(alert("Was not able to post URL after connecting account. Please try posting it again."),
closeTab())):alert("Please finish entering the correct values first.")}document.onreadystatechange=function(){if("complete"===document.readyState){var a=document.getElementById("settingsSubmit");a&&!a.onclick&&(a.onclick=function(){setAcctDetails();return!1})}};
